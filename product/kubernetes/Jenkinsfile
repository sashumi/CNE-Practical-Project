pipeline {
  agent any
  stages {
    stage('Deploy to EKS') {
      steps {
        sh '''cd product/kubernetes
              # download ansible vault password
              aws s3 cp \
                s3://shamsi-project2/keys/vault_password.txt \
                vault_password.txt

              # setup kubeconfig file
              aws eks \
                update-kubeconfig \
                --region eu-west-1 \
                --name prj2cluster

              # execute deployment playbook
              ansible-playbook deploy.yml \
                --vault-password-file vault_password.txt
'''
      }
    }

  }
}