pipeline {
  agent any
  stages {
    stage('Build test images and push to dockerhub') {
      steps {
        sh '''cd product
              ansible-playbook image_creator.yml --tags image_test'''
      }
    }

    stage('Run test activites usig images from dockerhub') {
      steps {
        sh '''eval `ssh-agent`
              ssh-add
              cd product
              export ANSIBLE_HOST_KEY_CHECKING=False
              #https://stackoverflow.com/questions/23074412/how-to-set-host-key-checking-false-in-ansible-inventory-file
              ansible-playbook -i test_inventory image_tester.yml --tags image_test '''
      }
    }
  }
}