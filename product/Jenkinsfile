pipeline {
  agent any
  stages {
    stage('Build test images and push to dockerhub') {
      steps {
        sh '''cd product
              ansible-playbook image_creator.yml --tags image_test'''
      }
    }

    stage('Run test activites usig images from dockerhub') {
      steps {
        sh '''cd product
              aws s3 cp s3://shamsi-project2/keys/id_rsa .
              chmod 0600 id_rsa
              export ANSIBLE_HOST_KEY_CHECKING=False
              ansible-playbook -i test_inventory \
                image_tester.yml\
                --tags image_test \
                --private-key id_rsa'''
      }
    }
  }
}